name: Snackager

defaults:
  run:
    working-directory: snackager

on:
  pull_request:
    paths:
      - .github/workflows/snackager.yml
      - snackager/**
      - packages/snack-sdk/**
      - .eslint*
      - .prettier*
      - yarn.lock

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: 🏗 Setup repository
        uses: actions/checkout@v3

      - name: 🏗 Setup secrets
        uses: sliteteam/github-action-git-crypt-unlock@a09ea5079c1b0e1887d4c8d7a4b20f00b5c2d06b
        env:
          GIT_CRYPT_KEY: ${{ secrets.GIT_CRYPT_KEY }}

      - name: 🏗 Setup snackager
        uses: ./.github/actions/setup-snackager

      - name: 🚨 Lint snackager
        run: yarn lint --max-warnings 0

      - name: 🧪 Unit test snackager
        run: yarn test --ci --testPathIgnorePatterns=__integration-tests__
      
      - name: 🧪 E2E test snackager
        run: yarn test --ci --runInBand --testPathPattern=__integration-tests__
